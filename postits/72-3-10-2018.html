<!DOCTYPE html>
<html>
<head>

	<!-- style -->
	<link rel="stylesheet" href="../css/style.css">

	<!-- favicon -->
	<link rel="icon" href="../things/compass.png">

	<title>72</title>

</head>
<body>

	<a href="../index.html">..</a>

	<br></br>
	
	<h3>Add Custom Markers in Mapbox GL JS - A Beginner's Tutorial</h3>

	This is the first of my mini-series of rewriting some of the Mapbox tutorials that might be overwhelming for people who haven't seen code before. <a href ="https://twitter.com/mzdraper">Let me know</a> what you think!

	<br></br>	

	We're going to build an interactive map with custom markers using Mapbox's JavaScript library called Mapbox GL JS (GL = Graphics library, JS = JavaScript). Here's a link to their actual tutorial and some examples of the map we'll be making today. This file explains every part of the code you're copying and pasting.

	<br></br>

	Here's what you'll need to get started:

	<ul>A <b>Mabox account</b> that can be made freely with an email address. You will need this to generate an <b>access token</b>, which allows you to access Mapbox's API. Find more information <a href="https://www.mapbox.com/account/access-tokens/">here</a></ul>

	<ul>A text editor, which is a computer application where you write code. I use <a href="https://www.sublimetext.com/">Sublime</a>, but I know <a href="https://atom.io/">Atom</a> is also quite popular. Follow their download instructions carefully.</ul>

	<ul>A new, empty folder called <code>map-markers</code> to store your HTML file and .PNG file.</ul>

	<ul>The <a href="https://github.com/mzdraper/mzdraper.github.io/blob/master/things/mapbox-icon.png">marker image</a> that can be downloaded here. Be sure to download it in the same folder as your <code>index.html</code> file.</ul>

	<ul><a href="https://github.com/mzdraper/mzdraper.github.io/blob/master/things/marker-map.html">My super-commented marker-map file</a>. This file contains all the code formatted correctly. I went through every line in the code and wrote extensive commentary explaining how it all works together. If you have knowledge of functions and variables, that would likely be more useful. But consider this document an 'in English' version of the code. The bits of this code (from Mapbox) and comments (from me) are in this tutorial to further explain what's going on while you do the tutorial. It's lengthy, but if you're new, it's a great place to start!</ul>

	<br>

	<h4>Step One: Initialize your Mapbox GL JS Map</h4>

	1. Open your text editor and save the file as <code>index.html</code>into your project folder.
	<br>
	2. Copy and paste the given code from Mapbox's tutorial.
	
	<xmp>
		<!DOCTYPE html>
		<html>
		<head>
		    <meta charset='utf-8' /> <!-- What character alphabet the computer can expect to read. -->
		    <title>Marker Map</title> <!-- This will appear as the name on the page tab. -->
		    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /> <!-- Actually don't worry -->

		    <!-- This links to the font used in the pop-up markers -->
		    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

		    <!-- These links load Mapbox GL JS to this dociment. -->
		    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
		    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />

		    <!-- This is in-HTML line scripting of CSS, or cascade style sheets. These sheets can be written inside of HTML like this between <script> tags, or they can be linked outside of HTML documents using <script src='style.css'></script>. Everything between this <script> tag is CSS. --> 
		    <style>
		    /* This styles everything in the body tags. */
		    body {
		    	margin: 0;
		        padding: 0;
		    }

		    /* This styles the map class. */
        	#map {
            position: absolute; /* Positioned relative to its first positioned (not static) ancestor element. */
            /* No spacing, so the map will take up the entire page. */
            top: 0;
            bottom: 0;
            width: 100%;
          }
		    </style>
		</head>

		<body>
		<!-- Creates a div (think like a physical bin) that can be referenced with the word "map" -->
    	<div id='map'></div>

    	<!-- Initiates JavaScript code. Everything between this <script> tag is JavaScript. -->
		<script>

		/* Replace with your Mapbox Access Token. */
		mapboxgl.accessToken = 'pk.eyJ1IjoibWFkaXpoZW4iLCJhIjoiY2lzbTViZ2ozMDAyejJ5bzFxaXB0MXN2eCJ9.YVS0Rlj7IjNHireL_ysr6w';

        /* This creates a new Map called "map" */
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v9', /* This style can be replaced as you see fit. */
            center: [-96, 37.8], /* When the new lap is initiated, these are the [lat, long] coordinates that it will be at. */
            zoom: 3 /* When the new map is initiated, this is is the zoom level that it will be out. */
        });

		// code from the next step will go here!

		</script>

		</body>
		</html>
	</xmp>

	3. Save your file.
	4. Right click your file in Finder/Explorer and open it with your preferred browser. You should see a blank web map appear.

	<br>

	<h4>Step Two: Load GeoJSON Data</h4>

	A GeoJSON is similar to a JSON file, but it is spatially bound via coordinates. If you're unsure of what a JSON file is, let alone a GeoJSON, think of it as a list with a lot of sublist information. This is a format of storing data in an organized format for users and computers to mutually understand. Similar to how an address book has a list of contacts, inside each contact card is a list of other information, like name, number, email, picture and notes.

	<br>

	This GeoJSON will be written in the same file near the bottom, replacing the <code>// code from the next step will go here!</code> comment. Copy and paste this code:

	<xmp>
	/* This creates an inline geojson. Think if it like an address book. The 'FeatureCollection' tells you there
	* are attributes. Then each {contact} tells you its type, it's address or 'geometry' and its properties or
	* letter contents. */
	var geojson =
	{
	    type: 'FeatureCollection',
	    features: [{
	        type: 'Feature',
	        geometry: {
	          type: 'Point',
	          coordinates: [-77.032, 38.913]
	        },
	        properties: {
	          title: 'Mapbox',
	          description: 'Washington, D.C.'
	        }
	    },
	    {
	        type: 'Feature',
	        geometry: {
	          type: 'Point',
	          coordinates: [-122.414, 37.776]
	        },
	        properties: {
	          title: 'Mapbox',
	          description: 'San Francisco, California'
	        }
	    }]
	};
	</xmp>

	Save your file, and refresh the page. You shouldn't see any changes, but it's always good to refresh at frequent intervals to make sure the code you just wrote doesn't conflict, or break, anything.


	<h4>Step Three: Add HTML Markers</h4>

	The file you downloaded at the beginning will be the map marker. It will be added to the map using Mapbox's GL JS library method called <a href="https://www.mapbox.com/mapbox-gl-js/api/#marker">Marker</a>, which attaches an empty <code>div</code> tag to each point in the GeoJSON. 

	<br></br>

	1. Let's add some styling to the markers by coping and pasting this code between the first set of <code>script</code> tags that contain CSS styling information.

	<xmp>
    /* This styles the marker id. */
    .marker {
        background-image: url('mapbox-icon.png'); /* Says where to find the marker image */
        background-size: cover; /* Resizes the background image to cover the entire container. */
        /* width, height & radius of the marker */
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer; /* When hovering over the link, the cursor will turn into a pointer to indicate functionality */
      }
	</xmp>

	<br>

	2. Now, let's add the markers to the map by copying and pasting this code between in the second pair of <code>script</code> tags right after the end of the <code>map</code> declaration but before the closing of the <code>script</code> tag.

	<xmp>
	/* This adds the markers and the pop-up text boxes (appears when the markers are clicked upon) to the map.
	*
	* This line can be better understood if you read in a funky and almost backwards way: for each marker apply 
	* this function (we'll get to 'this function' in a second). The marker can be found at a location indicated
	* in geojson's feature.
	*
	* 'This function' is latter indicated inside of the {} braces. The specifics of what each function does will 
	* be explained therein. */
	geojson.features.forEach(function(marker) {

	    /* Creates an HTML element for each feature, meaning it writes <div id='marker'></div>. This can be
	     * referenced and adjusted as needed. */
	    var el = document.createElement('div');
	    el.className = 'marker';

	    /* Make a marker for each feature and add to the map. */
	    new mapboxgl.Marker(el) 
	        .setLngLat(marker.geometry.coordinates) /* Gathers the coordinates from the geojson to use as [lat, long] for where the marker should pop-up. */
	        .addTo(map); /* Adds the marker to the map. */
	</xmp>

	3. Save your file. When you refresh the page, you should see markers on your map hovering over San Francisco and Washington DC.

	<h4>Step Four: Add Pop-Ups</h4>

	These pop-ups will be activated and therefore viewable when clicked. We'll be using the <code>mapbox.Marker</code>declaration to do so.

	<br></br>

	1. First, style the markers by coping and pasting this code between the first set of <code>script</code> tags for CSS.
	<xmp>
	    /* This refers to the pop-up's properties. */
        .mapboxgl-popup {
            max-width: 200px; /* This gives the width of the pop-up in pixels. */
          }

        /* This modifies the font within the pop-up. It centers and styles the font face respectfully. */
        .mapboxgl-popup-content {
            text-align: center;
            font-family: 'Open Sans', sans-serif;
         }
    </xmp>

    2. Attach the pop-ups to the markers by coping and pasting the code below into the tail end of the second set of <code>script</code> tags.
    <xmp>
    new mapboxgl.Marker(el)
        .setLngLat(marker.geometry.coordinates) /* Look familiar? Check line 123 if not. */
        .setPopup(new mapboxgl.Popup({ offset: 25 }) /* Adds pop-ups */
        .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>')) /* This is inline HTML, meaning that HTML tags are being applied to the text to adjust their formatting.  <h3> makes a small header from the information found in the given path: title > properties > marker > geojson. <p> does the same but location the description. */
        .addTo(map); /* Look familiar? Check line 124 if not. */
	});
	</xmp>

	3. Save your file, and refresh the page. You should see a map with two markers on it, and when you click on the markers, a small pop-up description should appear!

	That's it! Good job on completing your first web map--and potentially first web page, ever! Please <a href="https://twitter.com/mzdraper">message me</a> screen shots of your map, or let me know about any questions or comments you have. Thanks for reading!

</body>
</html> 
