<!DOCTYPE html>
<html>
<head>

	<!-- style -->
	<link rel="stylesheet" href="../css/style.css">

	<!-- favicon -->
	<link rel="icon" href="../things/compass.png">

	<title>73</title>

</head>
<body>

	<a href="../index.html">..</a>

	<br></br>
	
	<h3>Getting Started with the Mapbox Directions API - A Beginner's Tutorial</h3>

	This is the second in my mini-series of rewriting some of the Mapbox tutorials that might be overwhelming for people who haven't seen code before. Check out the <a href="https://mzdraper.github.io/postits/72-3-10-2018.html">first tutorial</a> to place markers on a map. <a href ="https://twitter.com/mzdraper">Let me know</a> what you think!

	<br></br>	

	We're going to use Mapbox GL JS and their directions API to route between two points and get directions. <a href="https://www.mapbox.com/help/getting-started-directions-api/#finished-product">Here</a> is a link to their actual tutorial and some examples of the map we'll be making today. 

	<br></br>

	Here's what you'll need to get started:

	<ul>A <b>Mapbox account</b> that can be made freely with an email address. You will need this to generate an <b>access token</b>, which allows you to access Mapbox's API. Find more information <a href="https://www.mapbox.com/account/access-tokens/">here</a></ul>

	<ul>A <b>text editor</b>, which is a computer application where you write code. I use <a href="https://www.sublimetext.com/">Sublime</a>, but I know <a href="https://atom.io/">Atom</a> is also quite popular. Follow their download instructions carefully.</ul>

	<ul>A <b>new, empty folder called <code>route</code></b> to store your HTML file.</ul>

	<ul><a href="https://github.com/mzdraper/mzdraper.github.io/blob/master/things/route.html">My super-commented route file</a>. This file contains all the code formatted correctly. I went through every line in the code and wrote extensive commentary explaining how it all works together. If you have knowledge of functions and variables, that would likely be more useful. But consider this document an 'in English' version of the code. The bits of this code (from Mapbox) and comments (from me) are in this tutorial to further explain what's going on while you do the tutorial. It's lengthy, but if you're new, it's a great place to start!</ul>

	<br>

	<h4>Step One: Initialize your Mapbox GL JS Map</h4>

	1. Open your text editor and save the file as <code>index.html</code>into your project folder.
	<br>
	2. Copy and paste the given code from Mapbox's tutorial.
	
	<xmp>
		<!DOCTYPE html>
		<html>
		<head>
		    <meta charset='utf-8' /> <!-- What character alphabet the computer can expect to read. -->
		    <title>Router</title> <!-- This will appear as the name on the page tab. -->
		    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /> <!-- Actually don't worry -->

		    <!-- These links load Mapbox GL JS to this document. -->
		    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
		    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />

		    <!-- This link loads the JavaScript Library jQuery, which allows DOM (Document object model) transversal. -->
        	<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>

		    <!-- This is in-HTML line scripting of CSS, or cascade style sheets. These sheets can be written inside of HTML like this between <script> tags, or they can be linked outside of HTML documents using <script src='style.css'></script>. Everything between this <script> tag is CSS. --> 
		    <style>
		    /* This styles everything in the body tags. */
		    body {
		    	margin: 0;
		        padding: 0;
		    }

		    /* This styles the map class. */
        	#map {
            position: absolute; /* Positioned relative to its first positioned (not static) ancestor element. */
            /* No spacing, so the map will take up the entire page. */
            top: 0;
            bottom: 0;
            width: 100%;
          }
		    </style>
		</head>

		<body>
		<!-- Creates a div (think like a physical bin) that can be referenced with the word "map" -->
    	<div id='map'></div>

    	<!-- Initiates JavaScript code. Everything between this <script> tag is JavaScript. -->
		<script>

		/* Replace with your Mapbox Access Token. */
		mapboxgl.accessToken = 'pk.eyJ1IjoibWFkaXpoZW4iLCJhIjoiY2lzbTViZ2ozMDAyejJ5bzFxaXB0MXN2eCJ9.YVS0Rlj7IjNHireL_ysr6w';

        /* This creates a new Map called "map" */
        var map = new mapboxgl.Map({
          container: 'map', /* Container ID */
          style: 'mapbox://styles/mapbox/streets-v9', /* This style can be replaced as you see fit. */
          center: [-84.52,39.12], /* When the new lap is initiated, these are the [lat, long] coordinates that it will be at. */
          zoom: 12 /* When the new map is initiated, this is is the zoom level that it will be out. */
        });
		// code from the next step will go here!

		</script>

		</body>
		</html>
	</xmp>

	3. Save your file.
	4. Right click your file in Finder/Explorer and open it with your preferred browser. You should see a blank web map appear.

	<br>

	<h4>Step Two: Add The Route</h4>

	The route is generated using Mapbox's Directions API using the built-in<code>getRoute</code> function. The result is added as a new layer. The <code>getRoute</code> requires a <code>start</code> and <code>end</code> coordinate to route from. Copy this code into the bottom of the <code>script</code> tag.

	<xmp>
    /* On the "map" object, load the given function. */
    map.on('load', function(){
      getRoute();
    });

    /* The function just above is defined here. The purpose of this function is that it's pulling the route based
     * off of given coordinates and Mapbox's Directions API. */
    function getRoute() {
      var start = [-84.518641, 39.134270]; /* This is the route's starting coordinates. */
      var end = [-84.512023, 39.102779]; /* This is the route's starting coordinates. */
      /* This is declaration is storing Mapbox's Directions API, start's first coordinate, starts second coordinate, end's first coordinate, end's second coordinate, a reference to their navigation access and finally your access token. */
      var directionsRequest = 'https://api.mapbox.com/directions/v5/mapbox/cycling/' + start[0] + ',' + start[1] + ';' + end[0] + ',' + end[1] + '?steps=true&geometries=geojson&access_token=' + mapboxgl.accessToken;
      
    /* If you're unfamiliar with jQuery and AJAX, here's a crash course! jQuery is a JavaScript Library 
     * pre-written code) designed to make it easier to navigate a document, select DOM elements, develop Ajax
     * applications and more. AJAX is short for Asynchronous JavaScript and XML, which is a set of web
     * development techniques used on the client side for asynchronous web apps. Asynchronous means that data can
     * be sent and received in the background without interfering with or slowing down the current display of a
     * page. If that is boggling, I recommend learning some JavaScript fundamentals before looking up jQuery or
     * AJAX. */
      $.ajax({ /* The $ is shorthand for using the jQuery library. jQuery.### == $.### */
        method: 'GET', /* Data is being received... */
        url: directionsRequest,  /* ... from this location. */
      }).done(function(data){ /* Once that is completed, run the received information (data) through this function. */
        var route = data.routes[0].geometry;
        map.addLayer({ /* These features are necessary identifying the route... */ 
          id: 'route', /* ... to be a route ... */
          type: 'line', /* ... that is linear. */
          source: { /* The route info can be accessed through... */
            type: 'geojson', /* ... a GeoJSON file format. Think of it like an address book. The 'FeatureCollection' tells you there are attributes. Then each {contact} tells you its type, it's address or 'geometry' and its properties or letter contents. */
            data: { /* This is the expected format of the data. */
              type: 'Feature', 
              geometry: route
            }
          },
          /* This makes the route visible by allocating a width to it. */
          paint: {
            'line-width': 2
          }
        });
      });
	}
	</xmp>

	Save your file, and refresh the page. You should see a bicycle route appear on your map!

	<h4>Step Three: Add an Origin and Destination</h4>

	This step will add two circles at the start and end of the route to indicate the route's end points.

	<br></br>

	1. Place the following code directly after the code that added the route.

	<xmp>
    /* These next two add starting and stopping indicators to the map. */
            map.addLayer({
              id: 'start', /* This is the bin it belongs to. */
              type: 'circle', /* This is the shape it will be. */
              source: { /* This is where it gets the data for where to put the dot. The format is the same as above. */
                type: 'geojson',
                data: { 
                  type: 'Feature', 
                  geometry: {
                    type: 'Point',
                    coordinates: start
                  }
                }
              }
            });
            /* This is the same as above, but with the end of route. */
            map.addLayer({
              id: 'end',
              type: 'circle',
              source: {
                type: 'geojson',
                data: { 
                  type: 'Feature', 
                  geometry: {
                    type: 'Point',
                    coordinates: end
                  }
                }
              }
            });

	</xmp>

	2. Save your file. When you refresh the page, you should see circular markers at each endpoint.

	<h4>Step Four: Add Turn-By-Turn Instructions</h4>

	These directions are created with Mapbox's directions API. Since you don't have to write them out yourself, you can generate directions around places you're unfamiliar with.

	<br></br>

	<xmp>
    /* This loads the instructions on the left side. It's loaded last so it's above the map. */
    var instructions = document.getElementById('instructions'); /* This is using jQuery to select the "instructions." The steps are going inside of this bin. */

    /* This collects the steps of the route. */
    var steps = data.routes[0].legs[0].steps;
    steps.forEach(function(step){ /* This can be read as: For each step, perform this function on the step. */
        /* With each step, insert it into the instructions bin with HTML <p> tags. This formatting helps
         * legibility by separating each step. */
        instructions.insertAdjacentHTML('beforeend', '<p>' + step.maneuver.instruction + '</p>');
      });
     });
    }    
    </xmp>

	Save your file, and refresh the page. You should see a map with a route, marked end points and turn-by-turn directions!

	That's it! Good job on completing your web map! Please <a href="https://twitter.com/mzdraper">message me</a> screen shots of your map, or let me know about any questions or comments you have. Thanks for reading!

</body>
</html> 
