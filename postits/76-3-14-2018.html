<!DOCTYPE html>
<html>
<head>

	<!-- style -->
	<link rel="stylesheet" href="../css/style.css">

	<!-- favicon -->
	<link rel="icon" href="../things/compass.png">

	<title>76</title>

</head>
<body>

	<a href="../index.html">..</a>

	<br></br>
	
	<h3>Make a Choropleth Map, Part 2: Create a Style - A Beginner's Tutorial</h3>

	This is the fifth in my mini-series of rewriting some of the Mapbox tutorials that might be overwhelming for people who haven't seen code before. Check out the <a href="https://mzdraper.github.io/postits/72-3-10-2018.html">first tutorial</a> to place markers on a map. <a href ="https://twitter.com/mzdraper">Let me know</a> what you think!

	<br></br>	

	Mapbox puts this in a two part series, the second of which involves [ADD]. While this may be difficult to describe without several images and GIFs, I'll be as succinctly descriptive as possible. <a href="https://www.mapbox.com/help/choropleth-studio-gl-pt-2/">Here</a> is a link to Mapbox's actual tutorial and some examples of the map we'll be making today. 

	<br></br>

	What you'll need to get started:

	<ul>A completion of <a href="https://mzdraper.github.io/postits/75-3-13-2018.html">Part 1</a></ul>

	<ul>The same <b>folder</b> called <code>Choropleth</code>, you'll be editing the same HTML file.</ul>

	<ul>A <b>text editor</b>, which is a computer application where you write code. I use <a href="https://www.sublimetext.com/">Sublime</a>, but I know <a href="https://atom.io/">Atom</a> is also quite popular. Follow their download instructions carefully.</ul>

	<ul><b>Mapbox GL JS</b> is a bundle of code that has pre-built functions for your map. GL JS stands for Graphics Library JavaScript. You won't have to purchase or download anything to use Mapbox GL JS non-commercially.</ul>

	<ul>A <b>Style URL</b> referencing your map from Part 1. Go to your Styles tab on the upper right of your account page. You should see a thumbnail of your map at the top of the list and a Menu button to its right. Click that and select <b>Share, develop, & use</b>. You'll be brought to a page that gives you different links based on the different ways you want 

	<ul><a href="https://github.com/mzdraper/mzdraper.github.io/blob/master/things/analyze-map.html">My super-commented route file</a>. This file contains all the code formatted correctly. I went through every line in the code and wrote extensive commentary explaining how it all works together. If you have knowledge of functions and variables, that would likely be more useful. But consider this document an 'in English' version of the code. The bits of this code (from Mapbox) and comments (from me) are in this tutorial to further explain what's going on while you do the tutorial. It's lengthy, but if you're new, it's a great place to start!</ul>

	<h4>Step One: Create a Webpage</h4>

	This is just the initialization of a web page using HTML. Don't worry if you don't see anything appear, we'll get the map loaded in the next step. 

	1. Open your text editor and post the following code. 
	
	<xmp>
	<!DOCTYPE html>
	<html>
	<head>
	    <meta charset='utf-8' /> <!-- What character alphabet the computer can expect to read. -->
	    <title>choropleth</title> <!-- This will appear as the name on the page tab. -->
	    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /> <!-- Actually don't worry -->

	     <!-- These links load Mapbox GL JS to this document. -->
	    <script src='https://api.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
	    <link href='https://api.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />

	    <!-- This is in-HTML line scripting of CSS, or cascade style sheets. These sheets can be written inside of HTML like this between <script> tags, or they can be linked outside of HTML documents using <script src='style.css'></script>. Everything between this <script> tag is CSS. --> 
	    <style>
	        /* This styles everything in the body tags. */
	        body { margin:0; padding:0; }  /* No spacing */

	        /* This styles everything in the h2 and h3 tags. */
	        h2, h3 {
	            margin: 10px; /* The margin will be 10 px */
	            font-size: 1.2em; /* Ems (em) is the scalable unit for web font sizes. */
	        }

	        /* This styles everything in the h3 tags. This will override above. */
	        h3 {
	            font-size: 1em;
	        }

	         /* This styles everything in the p tags. */
	        p {
	            font-size: 0.85em;
	            margin: 10px;
	            text-align: left; /* Text will be justified to the left an aligned to the bin. */
	        }

	        /* This styles everything in the mapoverlay div id. */
	        .map-overlay {
	            position: absolute; /* Positioned relative to its first positioned (not static) ancestor element. */

	            /* No spacing, so the map will take up the entire page. */
	            bottom: 0;
	            right: 0;
	            background: rgba(255, 255, 255, 0.8);  /* This is takes the RGBA code to style the background. */
	            margin-right: 20px; /* The right margin is set to 20px. */
	            font-family: Arial, sans-serif; /* This sets the font and style of the font. */
	            overflow: auto; /* If the overflow is clipped, then a scrollbar is added on the side. */
	            border-radius: 3px; /* Rounds the edges of the bin. */
	        }

	        /* This styles everything in the map class. */
	        #map {
	            position:absolute;
	            top:0;
	            bottom:0;
	            width:100%; /* To occupy the entirety of the screen despite size. */
	        }

	         /* This styles everything in the features class. */
	        #features {
	            top: 0;
	            height: 100px;
	            margin-top: 20px;
	            width: 250px;
	        }

	         /* This styles everything in the legend class. */
	        #legend {
	            padding: 10px;
	            box-shadow: 0 1px 2px rgba(0,0,0,0.10); /* Adds depth to the box by adding a styled boarder around it. */
	            line-height: 18px;
	            height: 150px;
	            margin-bottom: 40px;
	            width: 100px;
	        }

	        /* This styles everything in the legend-key div id. */
	        .legend-key {
	            display:inline-block; /* This creates a grid of boxes that fills the browser's width and auto-wraps  as the boarder resizes. */
	            border-radius: 20%;
	            width: 10px;
	            height: 10px;
	            margin-right: 5px;
	        }

	    </style>
	</head>
	<body>
		<!-- Creates classes and divs (think like a physical bin and sub-bins) that can be referenced with the word "map." The styling for each bin is listed above -->
		<div id='map'></div>
		<div class='map-overlay' id='features'><h2>US population density</h2><div id='pd'><p>Hover over a state!</p></div></div>
		<div class='map-overlay' id='legend'></div>
		<script>
			
		</script>
	</body>
	</html>

	2. Save your file, and open it in the browser. We'll save frequently just in case something breaks during that step. This process can catch bugs on the fly instead of having to back track through every line of code.

	<h4>Step Two: Initialize the Web Map</h4>

	You'll add the following code in between the empty script tags that are in the body tags.

	<xmp>
	/* Replace with your Mapbox Access Token */
	mapboxgl.accessToken = 'pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2lqbmpqazdlMDBsdnRva284cWd3bm11byJ9.V6Hg2oYJwMAxeoR9GEzkAA';

	/* This creates a new Map called "map" */
	var map = new mapboxgl.Map({
	    container: 'map', /* Container ID */
	    style: 'mapbox://styles/examples/cj2civacd00302rogivh6xbx2' /* This style can be replaced as you see fit. */
	});
	</xmp>

	Don't forget to save! Your map should be up and running and looking stunning!

	<h4>Step Three: Add Additional Information via Interactivity</h4>

	Now that we've got a map loaded onto a web page, let's make it interactive using the <code>load</code> event. Once the style has loaded onto the page, the <code>load</code> event will execute the callback function.

	1. Add the code below. It's a very large chunk of code, but it will make if you read the the comments. Because of the <code>load</code> event, everything will happen after the map style has loaded. If you'd like me to break this down more, <a href="https://twitter.com/mzdraper">let me know</a> and I'd be more than happy to explain it!

	<xmp>
	/* On the "map" object, load the given function. */
	map.on('load', function() {

	/* Make a pointer cursor and style it as default. */
	    map.getCanvas().style.cursor = 'default';

    /* Set map bounds to the continental US */
    map.fitBounds([[-133.2421875, 16.972741], [-47.63671875, 52.696361]]);

    // make a pointer cursor
    map.getCanvas().style.cursor = 'default';

    /* Defines the data's intervals and corresponding colours. */
    var layers = ['0-10', '10-20', '20-50', '50-100', '100-200', '200-500', '500-1000', '1000+'];
    var colors = ['#FFEDA0', '#FED976', '#FEB24C', '#FD8D3C', '#FC4E2A', '#E31A1C', '#BD0026', '#800026'];

    /* This for-loop creates the legend. A for-loop runs while for each time the condition is still true. In this scenario, the initial value of variable i is 0, while i is less than the length of the layers, perform this function and add 1 to i. */
    for (i = 0; i < layers.length; i++) {
        var layer = layers[i]; /* Since counting with programming starts at the letter 0, this takes the first layer, then second, then third, etc. */
        var color = colors[i];
        var item = document.createElement('div'); /* This creates a new element div tag. */
        var key = document.createElement('span'); /* This creates a new span. */
        key.className = 'legend-key'; /* Returns the class name of an element. */
        key.style.backgroundColor = color;

        var value = document.createElement('span');
        value.innerHTML = layer; /* The innerHTML of value is layer. */
        item.appendChild(key); /* Appends key node as the last child of item node. */
        item.appendChild(value); /* Appends value node as the last child of item node. */
        legend.appendChild(item); /* Appends item node as the last child of a legend. */
    }

    /* Changes the information displayed in the window when hovering over a state. It changes to the name of the state the cursor is hovering. */
    map.on('mousemove', function (e) {
        /* Checks to see if the point the cursor is hovering is a layer in statedata. It's then rendered to the map... */
        var states = map.queryRenderedFeatures(e.point, {
            layers: ['statedata']
        });

        /* So if states length is greater than 0, then the name of the state will be displayed, as styled by the HTML tags. */
	        if (states.length > 0) {
	            document.getElementById('pd').innerHTML = "<h3><strong>" + states[0].properties.name + "</strong></h3><p><strong><em>" + states[0].properties.density + "</strong> people per square mile</em></p>";
	        /* Else, it will display: Hover over a state!. */
	        } else {
	            document.getElementById('pd').innerHTML = '<p>Hover over a state!</p>';
	        }
	    });

	});
	</xmp>

	2. Save your file, then reload the page! Hover around!

	<br></br>

	That's it! Good job on adding interactivity and information onto your web map! Please <a href="https://twitter.com/mzdraper">message me</a> screen shots of your map, or let me know about any questions or comments you have. Thanks for reading!

</body>
</html> 
